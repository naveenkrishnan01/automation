#!/usr/bin/env ruby

require 'rubygems'

require 'watir-webdriver'
require 'selenium-webdriver'
require 'colorize'
require 'date'
require 'json'

configuration = JSON.parse(File.read('../conf.json'))
url = configuration ["url"]

puts "Starting Time now #{Time.now}".cyan
  
browser = Watir::Browser.new

#**********************************************
# log into admin tool and create new FB account
#**********************************************
browser.goto "admin.oprah.com"
sleep 2;
browser.link(:text, "Facebook Test Users").click;
sleep 3;
browser.text_field(:name, "login_email_username").set("naveenkris009@yahoo.com");
browser.text_field(:name, "login_password").set("hello123");
sleep 2;
browser.button(:src, "https://securestatic.oprah.com/css/ocom/globalassets/btn_SignIn.png").click;
sleep 2;
browser.button(:value, "Create User").click;
sleep 5;
email1 = browser.div(:id, "user_created").span(:class, "email").text
pass1 = browser.div(:id, "user_created").span(:class, "password").text
puts "#{email1}";
puts "#{pass1}";
sleep 3;
browser.div(:class, "ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").span(:class, "ui-icon ui-icon-closethick").click;
sleep 2;
browser.link(:href, "http://myown.oprah.com/logout.html").click;

browser.goto "https://www.facebook.com/"

browser.text_field(:id, "email").set(email1)
browser.text_field(:id, "pass").set(pass1)
browser.button(:type,"submit").click

sleep 3;

browser.goto "#{url}";
browser.cookies.clear

#f = File.open('output.txt', 'w')
#f.puts "open the file"

#begin
###############################
# check the tabs for OWN TV
##############################
browser.link(:href, 'http://www.oprah.com/omagazine.html').click;
sleep 2;
browser.link(:href, 'http://myown.oprah.com/register.html').click;
sleep 3;

browser.img(:id, 'facebook_register_btn').click;
sleep 3;
browser.window(:title => "Facebook").use do
   browser.button(:text => "Okay").click;
end
sleep 6;
#*************************
# click the news letter page and submit
#**************************
browser.button(:id => 'finish_btn', :class => 'ocom_button_dark').click;
sleep 3;
browser.link(:xpath, ".//*[@id='username']/a").click
sleep 8;
#****************************
# click the account settings and manage_news_letter to validate
#*******************************

browser.link(:text, "Account Settings").click;
browser.div(:id => 'newsletter_panel_switch_container').click;
sleep 5;
browser.link(:href => "http://mywon.oprah.com/logout.html");
sleep 5;

browser.goto "https://www.facebook.com/"
sleep 2;
browser.link(:id, "navAccountLink").click
sleep 3;
browser.button(:value,"Log Out").click
puts "Logged out from Facebook account".cyan

puts "Test now complete for Omag Subscription for exisitng FaceBook account".green

puts "End Time now #{Time.now}".cyan
#puts "#{email}";

browser.close

#rescue Exception => e
#  puts "Error nessage :"
#  puts e
#  puts 'problem with form submission on Omag subscription' 
#  browser.close
#end
